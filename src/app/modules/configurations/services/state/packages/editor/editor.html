<section horizontal-ui-sheet class="qor-sheet-full">
    <header horizontal-ui-sheet-header title="{{vm.domain.name}} > {{vm.editorService.service}}">
    </header>
    <div horizontal-ui-sheet-content>
        <div class="editor-content">
            <div class="filled-content">
                <h3 class="config-table-header">Packages</h3>
                <table class="table table-bordered config-table">
                    <thead table-fixed-header>
                    <tr>
                        <th></th>
                        <th ng-repeat="instance in vm.editorService.instances | orderBy:''" class="config-table-th">
                            <h4>{{instance}}</h4>
                            <span dropdown dropdown-append-to-body class="dropdown">
                                <button class="btn config-table-header-button" dropdown-toggle ng-hide="vm.requestsCounter != 0">
                                  {{vm.selectedVersion[instance]}}
                                  <span class="label label-success" ng-show="vm.isLive(instance, vm.selectedVersion[instance])">Live</span>
                                  <span class="fa fa-chevron-down pull-right"></span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li ng-repeat="version in vm.versions[instance] track by $index">
                                        <a ng-if="vm.changeSelected(instance, version)" ng-hide="vm.isVersionDeleted(instance, version)" ng-click="vm.changeSelectedVersion(instance, version);"
                                           ng-class="{'li-active': vm.selectedVersion[instance] == version}">
                                            {{version}}
                                            <span class="label label-success pull-right" ng-show="vm.isLive(instance, version)">Live</span>
                                        </a>
                                    </li>
                                </ul>
                                <span class="fa fa-copy copy-version" ng-click="vm.makeCopy(instance, vm.selectedVersion[instance])" ng-hide="vm.requestsCounter != 0"></span>
                                <span class="label label-success set-live-button"
                                      ng-hide="vm.isLive(instance, vm.selectedVersion[instance]) || vm.requestsCounter != 0"
                                      mwl-confirm
                                      instance="{{instance}}"
                                      title="Are you sure?"
                                      message="Make {{vm.selectedVersion[instance]}} live for {{instance}}"
                                      confirm-text="Yes"
                                      cancel-text="No"
                                      placement="bottom"
                                      on-confirm="vm.makeLive(instance, vm.selectedVersion[instance], $event)">Set live</span>
                            </span>
                        </th>
                    </tr>
                    </thead>
                    <tbody ng-hide="vm.requestsCounter != 0">
                    <tr ng-repeat="(valueName, allValues) in vm.values">
                        <th>
                            {{valueName}}
                        </th>
                        <th ng-repeat="instance in vm.editorService.instances | orderBy:''" parent="value[instance]" key="valueName"
                            versions="vm.editorService.versions"
                            ng-class="{'no-value': !vm.values[valueName][instance][vm.selectedVersion[instance]]}"
                            instance="instance" version="vm.selectedVersion[instance]"
                            inline-edit="vm.values[valueName][instance][selectedVersion[instance]]"
                            change-selected="vm.changeSelectedVersion"
                            on-save="vm.updateValues(name, newValue, instance, selectedVersion[instance], xDashVersion)"
                            class="config-input-th"></th>
                    </tr>
                    </tbody>
                </table>
            </div>
            <button class="btn btn-warning save-config-button" id="env-save-button" ng-click="vm.save()"
                    ng-show="vm.isSavable()">Save
            </button>
        </div>
    </div>

    <script type="text/ng-template" id="inlineEdit.html">
        <span  ng-show="isEditAvailable()" ng-click="edit()"
               class="config-table-action-btn fa fa-edit pull-right"></span>
        <textarea rows="1" type="text" on-enter="save()" on-esc="cancel()" ng-model="model" ng-show="editMode"
               class="config-input-edit"></textarea>
        <span ng-click="save()" ng-show="editMode && isSaveAvailable()"
              class="config-table-action-btn fa fa-check pull-right"></span>
        <span class="config-input-span" ng-hide="editMode" ng-click="edit()">{{model}}</span>
    </script>

    <script type="text/ng-template" id="newVersionModal.html">
        <div class="modal-header">
            <button type="button" class="close" ng-click="cancel()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Create copy of {{version}} in {{instance}}</h4>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="col-md-7">
                    <input type="text" class="form-control" ng-model="newVersionName" placeholder="New version name">
                </div>
                <div class="col-md-1 config-modal-devider">to</div>
                <div class="col-md-4">
                    <select id="select-type" ng-model="targetInstance" class="form-control">
                        <option value="">---Target instance---</option>
                        <option ng-repeat="instance in instances" value="{{instance}}">{{instance}}</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>
          <button class="btn btn-primary" id="config-modal-ok-button" type="button" ng-click="ok()">OK</button>
        </div>
    </script>

</section>
